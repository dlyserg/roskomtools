# roskomtools
Набор простых консольных утилит для операторов связи.

* ``rkn-load`` — осуществление выгрузки реестра запрещённых сайтов
* ``rkn-check`` — проверка качества блокировок

© 2015–2018 ООО «Оргтехсервис» (Илья Аверков, Маргарита Кособокова)

## Сборка и установка

Сначала необходимо сгенерировать deb-пакеты.

```bash
./build.sh
```

Затем — установить зависимости и сгенерированные deb-пакеты

```bash
sudo apt install python3 python3-requests python3-suds python3-lxml
sudo dpkg -i rkn-load.deb
sudo dpkg -i rkn-check.deb
```

## Использование

* Подкидываем файлы запроса и подписи в ``/etc/roskom/request.xml`` и ``/etc/roskom/request.xml.sign`` соответственно
* Запускаем ``rkn-load.py``. Будет произведена автоматическая выгрузка и в текущем каталоге появится файл ``dump.xml``.
* Редактируем ``/etc/roskom/config.py``, задаём строку для поиска. По наличию этой подстроки скрипт проверок будет автоматически определять то, что сайт блокируется успешно.
* Запускаем ``rkn-check.py`` в том же каталоге, в котором запускался ``rkn-load.py``. Будет сформирован файл ``result.txt``, содержащий список ссылок, по которым имеются проблемы с блокировками, и отметки времени UNIX, когда данная ссылка открылась. В процессе проверки данные также отображаются в реальном времени в стандартном потоке вывода. Прервать проверку можно нажатием ctrl-c.

## Статусы

* ``blocked`` — Ресурс успешно блокируется, получена страница-заглушка
* ``failure`` — Ресурс успешно блокируется, произошла ошибка TCP
* ``local-ip`` — Ресурс резолвится в локальный IP
* ``available`` — Ресурс **не блокируется**
